# ADR-0003: Аутентификация и авторизация: OAuth2/JWT + RBAC

- Статус: Accepted
- Дата: 2025-12-25
- Контекст проекта: Платформа для краудфандинга (авторы проектов, бэкеры/спонсоры, администраторы, потенциальные инвесторы)


## Контекст
Разные роли: автор, бэкер, администратор, потенциальный инвестор (read-only аналитика).
Нужно безопасно управлять доступом к проектам, платежам, модерации и админ-инструментам.

## Решение
- **Auth**: OAuth2 (email/password + соц.логины по желанию) с выпуском **JWT access token** (короткий TTL) и **refresh token** (длинный TTL).
- **RBAC**:
  - ROLE_AUTHOR: управление своими проектами, публикации обновлений, ответы в сообщениях.
  - ROLE_BACKER: взносы, просмотр статуса, отзывы/рейтинги, сообщения в рамках вложенных проектов.
  - ROLE_ADMIN: модерация проектов, управление пользователями, ручные проверки платежей/споров.
  - ROLE_INVESTOR: доступ к агрегированной аналитике (без персональных данных).
- **ABAC/Policy** точечно: права «автор проекта X», «бэкер проекта X», «модератор».

## Обоснование
- **Разные роли и контекстные права**: RBAC закрывает базовые роли, а точечный ABAC предотвращает утечки (доступ к чужим черновикам, переписке, платежам).
- **Безопасность**: короткоживущие access‑токены и управляемые refresh‑токены снижают риск компрометации.
- **Интеграции**: OAuth2 и JWT проще использовать во внешних сервисах (аналитика, CRM, мобильные клиенты).

## Альтернативы
1) Сессии (cookie) без токенов  
   + удобно для веба  
   − сложнее мобильные клиенты/интеграции, масштабирование.

2) Только RBAC без контекстных проверок  
   + просто  
   − появляются дырки (например, автор видит чужой проект в черновиках).

## Последствия
+ Удобно подключать мобильные/внешние клиенты.  
+ Ясная модель доступа (роль + контекст).  
− Нужно защищать refresh-токены (rotating refresh, хранение, отзыв) и внедрить MFA для админов.
