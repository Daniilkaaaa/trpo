# ADR-0009: Аналитика и отчётность: событийный сбор метрик + витрины

- Статус: Accepted
- Дата: 2025-12-25
- Контекст проекта: Платформа для краудфандинга (авторы проектов, бэкеры/спонсоры, администраторы, потенциальные инвесторы)


## Контекст
Администратору и инвестору нужны метрики: конверсия, успешность сборов, средний чек, возвраты, категории, ROI/возвратность.
Операционная БД не должна страдать от тяжелых аналитических запросов.

## Решение
- Операционные события (платежи, статусы проектов) пишутся в **event log**/очередь.
- ETL/ELT процесс грузит данные в аналитическую витрину (например, отдельная БД/колонночное хранилище).
- Для MVP допускается упрощение:
  - агрегаты в PostgreSQL (материализованные представления) + ограничения по времени выполнения,
  - постепенный переход к полноценной витрине при росте.

## Обоснование
- **Не перегружать production**: тяжелые аналитические запросы могут ухудшить работу платежей и пользовательских сценариев.
- **Трассируемость метрик**: событийная модель дает воспроизводимые данные и историю изменений (включая возвраты/споры).
- **Постепенное взросление**: можно начать с простых агрегатов и перейти к витрине/warehouse при росте.

## Альтернативы
1) Аналитика напрямую из PostgreSQL без ограничений  
   − риск деградации production.

2) Data Warehouse сразу  
   + масштабируемо  
   − дороже и сложнее для MVP.

## Последствия
+ Можно развивать аналитику по мере роста.  
+ Меньше риска «убить» транзакционную БД тяжелыми запросами.  
− Появляется задержка данных (near-real-time, не всегда real-time).
