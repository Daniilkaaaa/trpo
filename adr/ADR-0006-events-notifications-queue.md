# ADR-0006: Коммуникации и уведомления: событийная модель + очередь сообщений

- Статус: Accepted
- Дата: 2025-12-25
- Контекст проекта: Платформа для краудфандинга (авторы проектов, бэкеры/спонсоры, администраторы, потенциальные инвесторы)


## Контекст
Событий много: новый проект, модерация, новый взнос, достижение цели, обновление проекта, сообщения, отзывы.
Нужно доставлять уведомления (email/push/in-app) надежно и без блокировки основного потока.

## Решение
- Внутри системы вводим **domain events** (например: `ProjectPublished`, `ContributionSucceeded`, `ProjectFunded`, `UpdatePosted`).
- Публикация событий в **message broker** (RabbitMQ/Kafka/NATS — выбор зависит от команды/нагрузки).
- Асинхронные обработчики:
  - отправка email,
  - push-уведомления,
  - формирование дайджестов,
  - синхронизация индекса поиска,
  - сбор метрик/аналитики.
- Уведомления пользователю: настройки каналов и частоты (например, «только важное», «ежедневный дайджест»).

## Обоснование
- **Производительность и UX**: уведомления и побочные действия не должны тормозить критические операции (платежи, публикацию проекта).
- **Надежность доставки**: очередь позволяет ретраить, использовать DLQ и не терять уведомления при сбоях внешних сервисов (email/push).
- **Расширяемость**: события удобно подключают новые функции (аналитика, поиск, антифрод) без плотной связности.

## Альтернативы
1) Синхронные вызовы (без очереди)  
   − ухудшает задержки и надежность, сложно ретраить.

2) Cron-скрипты без событий  
   − плохо работает для «почти реального времени», выше лаги.

## Последствия
+ Система устойчивее: отказ почты/пушей не ломает платежи/публикацию.  
+ Можно масштабировать обработчики независимо.  
− Появляются требования к наблюдаемости (DLQ, retries, idempotent consumers).
